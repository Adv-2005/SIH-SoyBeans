<html>
<head>
  <style>
    /* Add some style for the map div */
    #map {
      height: 400px;
      width: 600px;
    }
  </style>
</head>
<body>
  <h1>Find the nearest e-waste facilities</h1>
  <div id="map"></div>
  <script>
    // Declare some global variables
    var map;
    var userMarker;
    var service;
    var infowindow; // Declare a global variable for the info window

    // Initialize the map and set its center and zoom level
    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -34.397, lng: 150.644 },
        zoom: 8,
      });
      // Get the user's current position and call the showPosition function
      navigator.geolocation.getCurrentPosition(showPosition);
      // Create a new info window and assign it to the global variable
      infowindow = new google.maps.InfoWindow();
    }

    // Create a marker for the user's position and add it to the map
    function showPosition(position) {
      var userLat = position.coords.latitude;
      var userLng = position.coords.longitude;
      var userLatLng = new google.maps.LatLng(userLat, userLng);
      userMarker = new google.maps.Marker({
        position: userLatLng,
        map: map,
        title: "Your location",
  

      });
      // Set the map's center to the user's position
      map.setCenter(userLatLng);
      // Search for nearby e-waste facilities using Places service
      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(
        {
          location: userLatLng,
          radius: 10000,
          keyword: "e-waste recycling",
        },
        showResults
      );
    }

    // Display the results as markers on the map
    function showResults(results, status) {
      if (status == google.maps.places.PlacesServiceStatus.OK) {
        for (var i = 0; i < results.length; i++) {
          var place = results[i];
          var placeMarker = new google.maps.Marker({
            position: place.geometry.location,
            map: map,
            title: place.name,
          });
          // Associate each marker with a place ID
          placeMarker.setPlace({
            placeId: place.place_id,
            location: place.geometry.location,
          });
          // Set the content of the info window to the name of the place
          infowindow.setContent(place.name);
          // Add a click listener to each marker
          placeMarker.addListener("click", showInfoWindow);
        }
      }
    }

    // Open the info window on the map and anchor it to the marker
    function showInfoWindow(event) {
      // Open the info window on the map and anchor it to the marker
      infowindow.open(map, this);
    }
  </script>
  <!-- Load the Maps JavaScript API and the Places Library with your API key -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUSjyXVreEY8nPddxSg9s4fHUyyEbiMA0&callback=initMap&libraries=places"
    async
  ></script>
</body>
</html>
